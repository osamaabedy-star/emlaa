<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الإملاء المنظور التفاعلي - أ/ أسامة إبراهيم</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Almarai:wght@300;400;700;800&family=Cairo:wght@200;300;400;600;700&family=Noto+Naskh+Arabic:wght@400;500;600;700&family=Lateef:wght@400;700&family=Scheherazade:wght@400;700&family=Tajawal:wght@400;500;700&family=El+Messiri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 15px;
            color: #333;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }
        
        .school-logo {
            height: 80px;
            width: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            border: 2px solid #f1c40f;
        }
        
        .header-text {
            flex: 1;
            text-align: center;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: #f1c40f;
        }
        
        .app-title {
            font-size: 1rem;
            color: white;
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .settings-btn {
            background: #f1c40f;
            color: #2c3e50;
            border: none;
            border-radius: 6px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }
        
        .settings-btn:hover {
            background: #f39c12;
            transform: translateY(-2px);
        }
        
        /* تصميم صفحة العرض التفاعلي */
        .display-section {
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 700px;
        }
        
        .display-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 12px;
            font-size: 1.6rem;
        }
        
        .main-display-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex: 1;
        }
        
        /* التصميم المعدل - وضع إملاء النص */
        .display-layout {
            display: grid;
            grid-template-columns: 2.5fr 1fr; /* تكبير مربع الإملاء في وضع النصوص */
            gap: 20px;
            flex: 1;
        }
        
        @media (max-width: 1024px) {
            .display-layout {
                grid-template-columns: 1fr;
            }
        }
        
        .word-display-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            height: 500px; /* زيادة الارتفاع لاحتواء النصوص */
        }
        
        .cards-display-area {
            background: #f8f9fa;
            padding: 15px; /* تصغير الحشوة */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            height: 500px; /* زيادة الارتفاع لتتناسب */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .cards-display-area h3 {
            color: #2c3e50;
            margin-bottom: 12px; /* تصغير المسافة */
            text-align: center;
            font-size: 1.2rem; /* تصغير الخط */
            padding: 8px; /* تصغير الحشوة */
            background: #ecf0f1;
            border-radius: 8px;
        }
        
        .word-display {
            padding: 25px 20px;
            background: white;
            border-radius: 15px;
            border: 5px solid #3498db;
            width: 100%;
            height: 350px; /* زيادة الارتفاع */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            font-size: 4.5rem; /* تصغير الخط قليلاً */
            text-align: center;
            line-height: 1.4;
            overflow: auto;
        }
        
        /* نمط لعرض النصوص الطويلة (إملاء نص) */
        .word-display.text-mode {
            font-size: 3.2rem; /* تصغير الخط للنصوص */
            padding: 20px 15px;
            line-height: 1.6;
            display: block;
            text-align: right;
            overflow-y: auto;
            height: 400px; /* زيادة الارتفاع للنصوص */
            word-wrap: break-word; /* الاحتواء التلقائي للنص */
            white-space: pre-wrap; /* يحافظ على فواصل الأسطر */
        }
        
        .timer-display {
            font-size: 2rem;
            color: #e74c3c;
            font-weight: bold;
            margin-top: 20px;
        }
        
        /* شريط التقدم الكامل - الرسائل في المنتصف */
        .full-progress-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(52, 152, 219, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transform: translateY(100%);
            transition: transform 0.5s ease;
            border-radius: 15px;
            z-index: 10;
            padding: 20px;
            text-align: center;
        }
        
        .full-progress-container.active {
            transform: translateY(0);
        }
        
        .full-progress-bar {
            width: 90%;
            height: 35px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 18px;
            overflow: hidden;
            border: 3px solid white;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .full-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #f1c40f, #e74c3c);
            width: 100%;
            transition: width 1s linear;
            border-radius: 18px;
        }
        
        .writing-text {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        
        .writing-timer {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #f1c40f;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        
        /* تصميم البطاقات - أصغر حجمًا */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px; /* تصغير المسافة بين البطاقات */
            flex: 1;
            overflow-y: hidden;
            padding: 5px; /* تصغير الحشوة */
        }
        
        /* تصميم البطاقات - وضع إملاء النص (5 بطاقات صغيرة) */
        .cards-grid.text-mode {
            grid-template-columns: repeat(1, 1fr);
            gap: 6px; /* تصغير المسافة بين البطاقات */
        }
        
        @media (max-width: 1400px) {
            .cards-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 1024px) {
            .cards-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .cards-grid.text-mode {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .cards-grid.text-mode {
                grid-template-columns: repeat(1, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .cards-grid.text-mode {
                grid-template-columns: repeat(1, 1fr);
            }
        }
        
        .card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem; /* تصغير حجم الخط */
            color: white;
            cursor: pointer;
            transition: all 0.5s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15); /* تصغير الظل */
            position: relative;
            transform-style: preserve-3d;
            user-select: none;
            font-weight: bold;
            height: 70px; /* تحديد ارتفاع أصغر للبطاقات */
        }
        
        /* في وضع إملاء النص، البطاقات أصغر حجماً */
        .cards-grid.text-mode .card {
            aspect-ratio: auto;
            height: 65px; /* تصغير حجم البطاقات أكثر */
            padding: 6px;
            font-size: 1rem;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #f1c40f, #f39c12);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }
        
        .card-front {
            font-size: 1rem; /* تصغير الخط */
            font-weight: bold;
        }
        
        /* في وضع إملاء النص، نغير حجم النص في البطاقات */
        .cards-grid.text-mode .card-front {
            font-size: 1.1rem;
        }
        
        .cards-grid.text-mode .card-back {
            font-size: 0.8rem; /* تصغير الخط */
            padding: 5px;
            line-height: 1.3;
        }
        
        .card-back {
            transform: rotateY(180deg);
            font-size: 0.75rem; /* تصغير الخط */
            color: #2c3e50;
            padding: 3px;
            word-break: break-word;
            text-align: center;
            background: white;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .card.used {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: default;
            opacity: 0.7;
        }
        
        .controls-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .status-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }
        
        @media (max-width: 768px) {
            .status-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .status-bar {
                grid-template-columns: 1fr;
            }
        }
        
        .status-item {
            text-align: center;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .start-btn {
            background: #2ecc71;
            color: white;
        }
        
        .start-btn:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        .finish-btn {
            background: #9b59b6;
            color: white;
        }
        
        .finish-btn:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }
        
        .restart-btn {
            background: #3498db;
            color: white;
        }
        
        .restart-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .reset-btn {
            background: #e74c3c;
            color: white;
        }
        
        .reset-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .show-words-btn {
            background: #f1c40f;
            color: #2c3e50;
        }
        
        .show-words-btn:hover {
            background: #f39c12;
            transform: translateY(-2px);
        }
        
        .text-mode-btn {
            background: #1abc9c;
            color: white;
        }
        
        .text-mode-btn:hover {
            background: #16a085;
            transform: translateY(-2px);
        }
        
        .words-mode-btn {
            background: #3498db;
            color: white;
        }
        
        .words-mode-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        /* نافذة الإعدادات */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .settings-modal.active {
            display: flex;
        }
        
        .settings-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 1400px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }
        
        .close-settings {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .settings-content h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 12px;
            font-size: 1.6rem;
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        @media (min-width: 1200px) {
            .main-layout {
                grid-template-columns: 1.2fr 1fr;
            }
        }
        
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* قاعدة الكلمات - تصميم جديد للمهارات */
        .word-bank-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .word-bank-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
        }
        
        /* تصميم جديد للمهارات - مربعات صغيرة */
        .skills-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .skill-box {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 12px 8px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            font-size: 0.85rem;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            border: 2px solid transparent;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .skill-box:hover {
            background: linear-gradient(135deg, #2980b9, #2573a7);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.2);
        }
        
        .skill-box.active {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            border-color: #e67e22;
        }
        
        /* نافذة الكلمات للمهارة */
        .words-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1002;
            padding: 20px;
        }
        
        .words-modal.active {
            display: flex;
        }
        
        .words-modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 25px;
            position: relative;
        }
        
        .close-words-modal {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .words-modal-content h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 12px;
            font-size: 1.4rem;
        }
        
        .modal-words-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .modal-words-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .skills-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .modal-words-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .skills-container {
                grid-template-columns: repeat(1, 1fr);
            }
        }
        
        .modal-word-tag {
            background: #3498db;
            color: white;
            padding: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            border: none;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
        }
        
        .modal-word-tag:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }
        
        /* تلوين الكلمات المحددة في نافذة المهارة */
        .modal-word-tag.selected {
            background: linear-gradient(135deg, #f1c40f, #e67e22) !important;
            color: #2c3e50 !important;
            border: 2px solid #d35400 !important;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2) !important;
            transform: translateY(-3px) !important;
        }
        
        .bank-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ecf0f1;
        }
        
        /* مهارات التعبئة العشوائية - مفعلة ومرئية */
        .skills-selection {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #9b59b6;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .skills-selection h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
            font-size: 0.95rem;
            font-weight: bold;
        }
        
        .skills-buttons {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .skills-buttons button {
            padding: 5px 10px;
            font-size: 0.75rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .select-all-btn {
            background: #2ecc71;
            color: white;
        }
        
        .deselect-all-btn {
            background: #e74c3c;
            color: white;
        }
        
        .skills-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }
        
        .skill-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .skill-checkbox input {
            width: 14px;
            height: 14px;
            accent-color: #3498db;
            flex-shrink: 0;
        }
        
        .skill-checkbox label {
            font-size: 0.75rem;
            color: #2c3e50;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }
        
        .bank-btn {
            padding: 8px 16px;
            background: #9b59b6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .bank-btn:hover {
            background: #8e44ad;
        }
        
        /* إعدادات الوقت والخط */
        .settings-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .time-settings-group {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }
        
        .time-settings-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
        }
        
        .time-controls-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .time-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .time-display {
            font-size: 1.6rem;
            font-weight: bold;
            color: #2c3e50;
            padding: 8px 16px;
            background: white;
            border-radius: 8px;
            border: 2px solid #3498db;
            min-width: 100px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .writing-time-display {
            border-color: #e74c3c;
        }
        
        .time-slider {
            width: 100%;
            height: 25px;
            -webkit-appearance: none;
            appearance: none;
            background: #ecf0f1;
            border-radius: 12px;
            outline: none;
            padding: 0 6px;
        }
        
        .time-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .time-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .time-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 0.75rem;
            color: #7f8c8d;
            margin-top: 2px;
        }
        
        /* إعدادات الخطوط */
        .font-settings-group {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }
        
        .font-settings-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
        }
        
        .font-settings-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .setting-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .setting-option {
            padding: 6px 12px;
            background: #ecf0f1;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.8rem;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .setting-option.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        /* أنواع الخطوط */
        .font-type-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .font-type-option {
            padding: 8px 4px;
            background: #ecf0f1;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.75rem;
            border: 2px solid transparent;
            transition: all 0.3s;
            text-align: center;
        }
        
        .font-type-option.selected {
            background: #9b59b6;
            color: white;
            border-color: #8e44ad;
        }
        
        /* أنواع الخطوط المختلفة */
        .font-cairo {
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
        }
        
        .font-amiri {
            font-family: 'Amiri', serif;
            font-weight: 700;
        }
        
        .font-almarai {
            font-family: 'Almarai', sans-serif;
            font-weight: 800;
        }
        
        .font-lateef {
            font-family: 'Lateef', serif;
            font-weight: 700;
        }
        
        .font-scheherazade {
            font-family: 'Scheherazade', serif;
            font-weight: 700;
        }
        
        .font-noto {
            font-family: 'Noto Naskh Arabic', serif;
            font-weight: 700;
        }
        
        .font-tajawal {
            font-family: 'Tajawal', sans-serif;
            font-weight: 700;
        }
        
        .font-messiri {
            font-family: 'El Messiri', sans-serif;
            font-weight: 700;
        }
        
        /* حقول إدخال الكلمات والنصوص */
        .words-input-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px; /* تصغير المسافة بين المربعات */
            margin-bottom: 12px;
        }
        
        .text-input-container {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 8px; /* تصغير المسافة بين المربعات */
            margin-bottom: 12px;
        }
        
        .word-input-box, .text-input-box {
            display: flex;
            flex-direction: column;
        }
        
        .word-label, .text-label {
            font-size: 0.65rem; /* تصغير الخط */
            color: #7f8c8d;
            margin-bottom: 2px;
            text-align: center;
        }
        
        .word-input {
            padding: 5px; /* تصغير الحشوة */
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem; /* تصغير الخط */
            text-align: center;
            transition: all 0.3s;
            height: 45px; /* تصغير الارتفاع */
        }
        
        .text-input {
            padding: 8px; /* تصغير الحشوة */
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem; /* تصغير الخط قليلاً */
            transition: all 0.3s;
            height: 110px; /* تصغير الارتفاع قليلاً */
            resize: vertical;
            font-family: 'Cairo', sans-serif;
            word-wrap: break-word; /* الاحتواء التلقائي للنص */
            white-space: pre-wrap; /* يحافظ على فواصل الأسطر */
        }
        
        .word-input:focus, .text-input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 6px rgba(52, 152, 219, 0.3);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        /* مربع الإدخال السريع */
        .quick-input-container {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #3498db;
        }
        
        .quick-input-container h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .quick-input-textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 10px;
            font-family: 'Cairo', sans-serif;
            word-wrap: break-word; /* الاحتواء التلقائي للنص */
            white-space: pre-wrap; /* يحافظ على فواصل الأسطر */
        }
        
        .quick-input-textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 6px rgba(52, 152, 219, 0.3);
        }
        
        .quick-input-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        /* مربع عرض الخط */
        .font-preview-container {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #9b59b6;
        }
        
        .font-preview-container h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .font-preview-box {
            width: 100%;
            height: 120px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            overflow: hidden;
            word-wrap: break-word; /* الاحتواء التلقائي للنص */
        }
        
        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .color-picker-label {
            font-size: 0.9rem;
            color: #2c3e50;
            font-weight: bold;
        }
        
        .color-picker {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: none;
        }
        
        /* نافذة عرض الكلمات المكتوبة - بحجم الشاشة */
        .words-review-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            padding: 20px;
        }
        
        .words-review-modal.active {
            display: flex;
        }
        
        .words-review-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 95vw;
            max-height: 90vh;
            overflow-y: auto;
            padding: 25px;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .close-review {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .close-review:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .words-review-content h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 12px;
            font-size: 1.8rem;
        }
        
        .review-words-list {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-top: 20px;
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        @media (max-width: 1200px) {
            .review-words-list {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 900px) {
            .review-words-list {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .review-words-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .review-words-list {
                grid-template-columns: repeat(1, 1fr);
            }
        }
        
        .review-word-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.8rem; /* تكبير الخط */
            font-weight: bold;
            border: 3px solid #3498db;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 120px; /* تكبير المربعات */
            transition: all 0.3s;
            word-wrap: break-word;
            overflow: hidden;
        }
        
        .review-word-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        
        /* رسالة نجاح */
        .success-message {
            position: fixed;
            top: 15px;
            right: 15px;
            background: #2ecc71;
            color: white;
            padding: 10px 18px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            display: none;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* نافذة التعليمات - إضافة جديدة */
        .instructions-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1003;
            padding: 20px;
        }
        
        .instructions-modal.active {
            display: flex;
        }
        
        .instructions-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border: 5px solid #f1c40f;
        }
        
        .close-instructions {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }
        
        .close-instructions:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .instructions-content h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .instructions-content h2 i {
            color: #f1c40f;
            margin-left: 10px;
        }
        
        .instructions-content h3 {
            color: #e74c3c;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4rem;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-right: 5px solid #3498db;
        }
        
        .instructions-steps {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .instruction-step {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 18px;
            background: #f8f9fa;
            border-radius: 10px;
            border-right: 4px solid #9b59b6;
            transition: all 0.3s;
        }
        
        .instruction-step:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .step-number {
            background: #3498db;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        
        .step-text {
            font-size: 1.1rem;
            color: #2c3e50;
            text-align: right;
            flex: 1;
            line-height: 1.6;
        }
        
        .step-text strong {
            color: #e74c3c;
            background: #fff8e1;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .step-text .highlight {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .instructions-image {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #3498db;
        }
        
        .instructions-image i {
            font-size: 4rem;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .instructions-image p {
            color: #7f8c8d;
            font-size: 1rem;
            margin-top: 10px;
        }
        
        .instructions-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .instruction-btn {
            padding: 14px 35px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .instruction-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.2);
        }
        
        .instruction-btn.open-settings {
            background: #f1c40f;
            color: #2c3e50;
        }
        
        .instruction-btn.open-settings:hover {
            background: #f39c12;
        }
        
        .instruction-btn.understand {
            background: #3498db;
            color: white;
        }
        
        .instruction-btn.understand:hover {
            background: #2980b9;
        }
        
        .quick-tip {
            margin-top: 25px;
            padding: 15px;
            background: #e8f4fc;
            border-radius: 10px;
            border-right: 4px solid #3498db;
            text-align: center;
        }
        
        .quick-tip h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .quick-tip p {
            color: #2c3e50;
            font-size: 1rem;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .instructions-content {
                max-width: 95%;
                padding: 20px;
            }
            
            .instruction-step {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .step-text {
                text-align: center;
            }
            
            .instructions-buttons {
                flex-direction: column;
            }
            
            .instruction-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* التذييل المعدل - سطر واحد فقط */
        .teacher-footer {
            text-align: center;
            padding: 12px 20px;
            background: #2c3e50;
            color: white;
            margin-top: 20px;
            border-radius: 0 0 12px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            border-top: 3px solid #f1c40f;
            font-size: 0.9rem;
            min-height: 50px;
        }
        
        .teacher-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            flex: 1;
        }
        
        .teacher-name {
            color: #f1c40f;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .teacher-year {
            color: #ecf0f1;
            padding: 2px 8px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 4px;
            border-right: 2px solid #3498db;
            border-left: 2px solid #3498db;
            font-size: 0.9rem;
        }
        
        .school-name {
            color: #ecf0f1;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }
        
        .separator {
            color: #f1c40f;
            margin: 0 8px;
        }
        
        .contact-btn {
            background: #25D366;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .contact-btn:hover {
            background: #128C7E;
            transform: translateY(-2px);
        }
        
        .footer-subtitle {
            font-size: 0.8rem;
            color: #ecf0f1;
            opacity: 0.8;
            text-align: center;
            width: 100%;
            margin-top: 5px;
            display: none; /* مخفي في التصميم الجديد */
        }
        
        /* تحسينات للأجهزة المختلفة */
        @media (max-width: 1200px) {
            .word-display {
                height: 300px;
                font-size: 4rem;
            }
            
            .word-display.text-mode {
                height: 350px;
                font-size: 2.8rem;
            }
            
            .word-display-container,
            .cards-display-area {
                height: 450px;
            }
            
            .review-word-item {
                font-size: 1.6rem;
                min-height: 100px;
            }
        }
        
        @media (max-width: 768px) {
            .word-display {
                height: 250px;
                font-size: 3.5rem;
                padding: 20px 15px;
            }
            
            .word-display.text-mode {
                height: 280px;
                font-size: 2.2rem;
            }
            
            .word-display-container,
            .cards-display-area {
                height: 380px;
            }
            
            .writing-text {
                font-size: 2rem;
            }
            
            .writing-timer {
                font-size: 3rem;
            }
            
            .card-front {
                font-size: 1rem;
            }
            
            .card-back {
                font-size: 0.8rem;
            }
            
            .teacher-footer {
                flex-direction: column;
                padding: 10px;
                gap: 10px;
                min-height: 70px;
            }
            
            .teacher-info {
                flex-direction: column;
                gap: 5px;
            }
            
            .teacher-name {
                font-size: 0.9rem;
            }
            
            .teacher-year {
                font-size: 0.85rem;
            }
            
            .school-name {
                font-size: 0.85rem;
            }
            
            .review-word-item {
                font-size: 1.4rem;
                min-height: 90px;
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .word-display {
                height: 200px;
                font-size: 3rem;
            }
            
            .word-display.text-mode {
                height: 220px;
                font-size: 1.8rem;
            }
            
            .word-display-container,
            .cards-display-area {
                height: 320px;
            }
            
            .writing-text {
                font-size: 1.8rem;
            }
            
            .writing-timer {
                font-size: 2.5rem;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .game-controls button {
                width: 100%;
                max-width: 280px;
            }
            
            .review-word-item {
                font-size: 1.2rem;
                min-height: 80px;
                padding: 12px;
            }
            
            .teacher-footer {
                min-height: 80px;
            }
        }
        
        .hidden {
            display: none !important;
        }
        
        /* علامة التبويب للنمط */
        .mode-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        
        .mode-tab {
            padding: 10px 20px;
            background: #ecf0f1;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .mode-tab.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        /* مؤشر الوضع */
        .mode-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f1c40f;
            color: #2c3e50;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 5;
        }
        
        /* تعديلات خاصة بوضع إملاء النص */
        .text-mode-title {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* تصميم المطور في الجانب */
        .developer-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-left: 20px;
        }
        
        /* وضع التكيف للشاشات الصغيرة */
        @media (max-width: 768px) {
            .display-layout.text-mode {
                grid-template-columns: 1fr;
            }
            
            .developer-info {
                align-items: center;
                margin-left: 0;
                margin-top: 10px;
            }
        }
        
        /* احتواء النص تلقائياً */
        .text-auto-fit {
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
        }
        
        /* نافذة اختيار الكلمات */
        .words-modal-footer {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ecf0f1;
        }
    </style>
</head>
<body>
    <!-- رسالة نجاح -->
    <div class="success-message" id="success-message">
        <i class="fas fa-check-circle"></i> تمت العملية بنجاح
    </div>
    
    <!-- نافذة الإعدادات -->
    <div class="settings-modal" id="settings-modal">
        <div class="settings-content">
            <button class="close-settings" id="close-settings">
                <i class="fas fa-times"></i>
            </button>
            
            <h2><i class="fas fa-cog"></i> إعدادات الإملاء</h2>
            
            <div class="main-layout">
                <div class="left-panel">
                    <div class="word-bank-section">
                        <div class="mode-tabs" id="mode-tabs">
                            <div class="mode-tab active" data-mode="words">إملاء الكلمات</div>
                            <div class="mode-tab" data-mode="text">إملاء نص</div>
                        </div>
                        
                        <!-- قسم إملاء الكلمات -->
                        <div id="words-mode-settings">
                            <h3><i class="fas fa-book"></i> الكلمات بناء على نوع المهارة</h3>
                            
                            <!-- مربعات المهارات -->
                            <div class="skills-container" id="skills-container">
                                <!-- سيتم إنشاء مربعات المهارات ديناميكياً -->
                            </div>
                            
                            <div class="bank-controls">
                                <!-- مهارات التعبئة العشوائية - مفعلة -->
                                <div class="skills-selection">
                                    <h4>اختر المهارات للتعبئة العشوائية:</h4>
                                    <div class="skills-buttons">
                                        <button class="select-all-btn" id="select-all-btn">
                                            <i class="fas fa-check-square"></i> كل المهارات
                                        </button>
                                        <button class="deselect-all-btn" id="deselect-all-btn">
                                            <i class="fas fa-times-circle"></i> لا شيء
                                        </button>
                                    </div>
                                    <div class="skills-grid" id="skills-grid">
                                        <!-- سيتم إنشاء مربعات الاختيار للمهارات -->
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 10px; justify-content: center;">
                                    <button class="bank-btn" id="fill-random-btn">تعبئة عشوائية</button>
                                    <button class="bank-btn" id="clear-all-btn">إفراغ الحقول</button>
                                </div>
                            </div>
                            
                            <!-- مربع الإدخال السريع -->
                            <div class="quick-input-container">
                                <h4><i class="fas fa-paste"></i> إدخال سريع للكلمات (20 كلمة)</h4>
                                <textarea class="quick-input-textarea text-auto-fit" id="quick-input-textarea" placeholder="ضع هنا قائمة الكلمات (20 كلمة) مفصولة بفواصل أو مسافات أو أسطر جديدة..."></textarea>
                                <div class="quick-input-buttons">
                                    <button class="bank-btn" id="load-words-btn">تحميل الكلمات</button>
                                    <button class="bank-btn" id="clear-textarea-btn">مسح</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- قسم إملاء النص -->
                        <div id="text-mode-settings" class="hidden">
                            <h3><i class="fas fa-font"></i> نصوص الكتابة الجاهزة (5 نصوص)</h3>
                            
                            <div class="quick-input-container">
                                <h4><i class="fas fa-paste"></i> إدخال سريع للنصوص (5 نصوص)</h4>
                                <textarea class="quick-input-textarea text-auto-fit" id="quick-text-input-textarea" placeholder="ضع هنا قائمة النصوص (5 نصوص) مفصولة بأسطر جديدة..."></textarea>
                                <div class="quick-input-buttons">
                                    <button class="bank-btn" id="load-texts-btn">تحميل النصوص</button>
                                    <button class="bank-btn" id="clear-text-textarea-btn">مسح</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="right-panel">
                    <div class="settings-section">
                        <!-- إعدادات الوقت -->
                        <div class="time-settings-group">
                            <h3>إعدادات الوقت</h3>
                            <div class="time-controls-container">
                                <div class="time-control">
                                    <div class="time-display" id="display-time-display">5 ثواني</div>
                                    <input type="range" min="5" max="120" step="5" value="5" class="time-slider" id="display-time-slider">
                                    <div class="time-labels">
                                        <span>5 ث</span>
                                        <span>120 ث</span>
                                    </div>
                                </div>
                                
                                <div class="time-control">
                                    <div class="time-display writing-time-display" id="writing-time-display">30 ثانية</div>
                                    <input type="range" min="10" max="300" step="5" value="30" class="time-slider" id="writing-time-slider">
                                    <div class="time-labels">
                                        <span>10 ث</span>
                                        <span>300 ث</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- إعدادات الخطوط -->
                        <div class="font-settings-group">
                            <h3>إعدادات الخط</h3>
                            <div class="font-settings-container">
                                <div>
                                    <h4>حجم الخط</h4>
                                    <div class="setting-options">
                                        <div class="setting-option selected" data-font-size="medium">متوسط</div>
                                        <div class="setting-option" data-font-size="large">كبير</div>
                                        <div class="setting-option" data-font-size="very-large">كبير جداً</div>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4>نوع الخط (للطلاب الصغار)</h4>
                                    <div class="font-type-options">
                                        <div class="font-type-option font-cairo selected" data-font-type="cairo">قاهر</div>
                                        <div class="font-type-option font-amiri" data-font-type="amiri">أميري</div>
                                        <div class="font-type-option font-almarai" data-font-type="almarai">المراعي</div>
                                        <div class="font-type-option font-lateef" data-font-type="lateef">لطيف</div>
                                        <div class="font-type-option font-scheherazade" data-font-type="scheherazade">شهرزاد</div>
                                        <div class="font-type-option font-noto" data-font-type="noto">نوطو</div>
                                        <div class="font-type-option font-tajawal" data-font-type="tajawal">تجاول</div>
                                        <div class="font-type-option font-messiri" data-font-type="messiri">المسيري</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- مربع عرض تجريبي للخط -->
                            <div class="font-preview-container">
                                <h4><i class="fas fa-eye"></i> عرض تجريبي للخط</h4>
                                <div class="font-preview-box text-auto-fit" id="font-preview-box">
                                    كلمة تجريبية
                                </div>
                                <div class="color-picker-container">
                                    <span class="color-picker-label">لون النص:</span>
                                    <input type="color" class="color-picker" id="color-picker" value="#2c3e50">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- حقول إدخال الكلمات -->
                    <div class="setting-group" id="words-input-group">
                        <h3>الحقول الـ 20 لكلمات الإملاء</h3>
                        <div class="words-input-container" id="words-input-container">
                            <!-- سيتم إنشاء 20 مربع إدخال -->
                        </div>
                    </div>
                    
                    <!-- حقول إدخال النصوص -->
                    <div class="setting-group hidden" id="texts-input-group">
                        <h3 class="text-mode-title">الحقول الـ 5 لنصوص الإملاء</h3>
                        <div class="text-input-container" id="texts-input-container">
                            <!-- سيتم إنشاء 5 مربع إدخال للنصوص -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="start-btn" id="start-btn">
                    <i class="fas fa-play"></i> بدء الإملاء
                </button>
                <button class="reset-btn" id="reset-btn">
                    <i class="fas fa-redo"></i> إعادة تعيين
                </button>
            </div>
        </div>
    </div>
    
    <!-- نافذة عرض الكلمات للمهارة -->
    <div class="words-modal" id="words-modal">
        <div class="words-modal-content">
            <button class="close-words-modal" id="close-words-modal">
                <i class="fas fa-times"></i>
            </button>
            
            <h3 id="modal-skill-title">كلمات المهارة</h3>
            <div class="modal-words-grid" id="modal-words-grid">
                <!-- سيتم إنشاء الكلمات هنا -->
            </div>
            
            <div class="words-modal-footer">
                <button class="bank-btn" id="select-all-words-btn">
                    <i class="fas fa-check-square"></i> تحديد الكل
                </button>
                <button class="bank-btn" id="add-selected-words-btn">
                    <i class="fas fa-plus-circle"></i> إضافة الكلمات المحددة
                </button>
            </div>
        </div>
    </div>
    
    <!-- نافذة عرض الكلمات المكتوبة - بحجم الشاشة -->
    <div class="words-review-modal" id="words-review-modal">
        <div class="words-review-content">
            <button class="close-review" id="close-review">
                <i class="fas fa-times"></i>
            </button>
            
            <h2><i class="fas fa-list-check"></i> الكلمات/النصوص التي تمت كتابتها</h2>
            <p style="text-align: center; margin-bottom: 20px; color: #7f8c8d; font-size: 1.2rem;">
                إجمالي العناصر: <span id="total-words-count">0</span> عنصر
            </p>
            
            <div class="review-words-list" id="review-words-list">
                <!-- سيتم إنشاء قائمة الكلمات هنا -->
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="close-review-btn" id="close-review-btn" style="padding: 10px 30px; background: #3498db; color: white; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer;">
                    <i class="fas fa-check-circle"></i> إنهاء العرض
                </button>
            </div>
        </div>
    </div>
    
    <!-- نافذة التعليمات - إضافة جديدة -->
    <div class="instructions-modal" id="instructions-modal">
        <div class="instructions-content">
            <button class="close-instructions" id="close-instructions">
                <i class="fas fa-times"></i>
            </button>
            
            <h2><i class="fas fa-info-circle"></i> دليل إضافة الكلمات - شرح مبسط</h2>
            
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 20px; font-size: 1.1rem;">
                لأنك ضغطت على البطاقة رقم <strong>1</strong> وهي فارغة. يجب إضافة الكلمات أولاً من الإعدادات.
            </p>
            
            <div class="instructions-steps">
                <div class="instruction-step">
                    <div class="step-number">1</div>
                    <div class="step-text">
                        <strong>الخطوة الأولى:</strong> اضغط على زر <strong>"إعدادات الإملاء"</strong> في أعلى الشاشة
                        <br><span class="highlight">(الزر الأصفر في الزاوية اليسرى)</span>
                    </div>
                </div>
                
                <div class="instruction-step">
                    <div class="step-number">2</div>
                    <div class="step-text">
                        <strong>الخطوة الثانية:</strong> ستظهر نافذة الإعدادات. اختر <strong>المهارة</strong> التي تريدها
                        <br><span class="highlight">(مثل: كلمات سهلة، مد الألف، الـ الشمسية... إلخ)</span>
                    </div>
                </div>
                
                <div class="instruction-step">
                    <div class="step-number">3</div>
                    <div class="step-text">
                        <strong>الخطوة الثالثة:</strong> اختر الكلمات من القائمة التي تظهر
                        <br><span class="highlight">(اضغط على الكلمات التي تريدها، ثم اضغط "إضافة الكلمات المحددة")</span>
                    </div>
                </div>
                
                <div class="instruction-step">
                    <div class="step-number">4</div>
                    <div class="step-text">
                        <strong>الخطوة الرابعة:</strong> بعد إضافة الكلمات، اضغط على زر <strong>"بدء الإملاء"</strong>
                        <br><span class="highlight">(الزر الأخضر في أسفل نافذة الإعدادات)</span>
                    </div>
                </div>
                
                <div class="instruction-step">
                    <div class="step-number">5</div>
                    <div class="step-text">
                        <strong>الخطوة الخامسة:</strong> الآن يمكنك الضغط على أي بطاقة لعرض الكلمة
                        <br><span class="highlight">(سيعرض الكلمة للطلاب، ثم يعطيهم وقت للكتابة)</span>
                    </div>
                </div>
            </div>
            
            <div class="instructions-image">
                <i class="fas fa-magic"></i>
            </div>
            
            <div class="quick-tip">
            </div>
            
            <div class="instructions-buttons">
                <button class="instruction-btn open-settings" id="open-settings-from-instructions">
                    <i class="fas fa-cog"></i> فتح الإعدادات الآن
                </button>
                <button class="instruction-btn understand" id="understand-instructions">
                    <i class="fas fa-check"></i> فهمت، شكراً لك
                </button>
            </div>
        </div>
    </div>
    
    <!-- الصفحة الرئيسية -->
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="https://www.wzufa.com/wp-content/uploads/2022/07/Riyadh-Al-Ebdaa-Schools.png" alt="شعار مدارس الإبداع بالرياض" class="school-logo">
            </div>
            <div class="header-text">
                <h1>الإملاء المنظور التفاعلي</h1>
                <div class="app-title">أداة تعليمية تفاعلية للصفوف الأولية</div>
            </div>
            <button class="settings-btn" id="open-settings">
                <i class="fas fa-cog"></i> إعدادات الإملاء
            </button>
        </div>
        
        <!-- صفحة العرض التفاعلي -->
        <div class="display-section" id="display-section">
            <h2><i class="fas fa-eye"></i> صفحة العرض التفاعلي</h2>
            
            <div class="main-display-area">
                <div class="display-layout" id="display-layout">
                    <div class="word-display-container">
                        <div class="word-display font-cairo text-auto-fit" id="word-display">
                            اختر رقم
                        </div>
                        <div class="timer-display" id="timer-display">--</div>
                        
                        <!-- شريط التقدم الكامل -->
                        <div class="full-progress-container" id="full-progress-container">
                            <div class="writing-text">اكتب في دفترك</div>
                            <div class="writing-timer" id="writing-timer">30</div>
                            <div class="full-progress-bar">
                                <div class="full-progress-fill" id="full-progress-fill"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="cards-display-area">
                        <h3 id="cards-title">اختر رقم</h3>
                        <div class="cards-grid" id="cards-grid">
                            <!-- سيتم إنشاء البطاقات ديناميكياً -->
                        </div>
                    </div>
                </div>
                
                <div class="controls-section">
                    <div class="status-bar">
                        <div class="status-item">
                            <div class="status-label">الكلمات المتبقية</div>
                            <div class="status-value" id="remaining-words">20</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">الكلمات المعروضة</div>
                            <div class="status-value" id="shown-words">0</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">وقت الكتابة</div>
                            <div class="status-value" id="writing-time-status">30 ثانية</div>
                        </div>
                    </div>
                    
                    <div class="game-controls">
                        <button class="restart-btn" id="restart-btn">
                            <i class="fas fa-sync-alt"></i> إعادة التشغيل
                        </button>
                        <button class="finish-btn" id="finish-btn">
                            <i class="fas fa-flag-checkered"></i> إنهاء الإملاء
                        </button>
                        <button class="show-words-btn" id="show-words-btn">
                            <i class="fas fa-list-check"></i> عرض المكتوب
                        </button>
                        <button class="text-mode-btn" id="text-mode-btn">
                            <i class="fas fa-font"></i> التبديل إلى إملاء نص
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- التذييل المعدل - سطر واحد فقط -->
        <div class="teacher-footer">
            <div class="teacher-info">
                <div class="teacher-name">
                    <i class="fas fa-chalkboard-teacher"></i> تصميم وتطوير أ / أسامة إبراهيم
                    <span class="teacher-year">2026</span>
                </div>
                <span class="separator">|</span>
                <div class="school-name">
                    <i class="fas fa-school"></i> مدارس رياض الإبداع الأهلية
                </div>
            </div>
            
            <a href="https://wa.me/966541334071" class="contact-btn" target="_blank">
                <i class="fab fa-whatsapp"></i> تواصل عبر واتساب
            </a>
        </div>
    </div>

    <script>
        // قاعدة الكلمات المعدلة بالحركات والمهارات الصحيحة (30 كلمة لكل مهارة)
        const wordBank = {
            // كلمات ثلاثية بالفتح (فعل ماضٍ ثلاثي بسيط)
            threeFatha: [
                "أَكَلَ", "ذَهَبَ", "خَرَجَ", "دَخَلَ", "رَسَمَ", "سَجَدَ", "شَكَرَ", "صَبَرَ", "ضَرَبَ", "طَلَبَ",
                "عَبَدَ", "غَسَلَ", "فَتَحَ", "قَرَأَ", "كَتَبَ", "نَظَرَ", "هَرَبَ", "وَجَدَ", "وَضَعَ", "نَزَلَ",
                "بَحَثَ", "جَلَسَ", "حَمَلَ", "خَلَقَ", "ذَبَحَ", "رَكَعَ", "زَرَعَ", "سَأَلَ", "شَرَحَ", "قَطَعَ"
            ],
            
            // كلمات ثلاثية بالحركات المختلفة (ضمة، فتحة، كسرة)
            threeVarious: [
                "قَلَمٌ", "عِنَبٌ", "أُذُنٌ", "رَجُلٌ", "كُرَةٌ", "لُبْنٌ", "حُلْمٌ", "عِلْمٌ", "قَمَرٌ", "بَحْرٌ",
                "جَبَلٌ", "نَهْرٌ", "خُبْزٌ", "مِلْحٌ", "سُكَّرٌ", "زُبْدٌ", "بَيْضٌ", "تَمْرٌ", "تِينٌ", "أَرْزٌ",
                "بِنْتٌ", "وَلَدٌ", "أُمٌّ", "أَبٌ", "أَخٌ", "أُخْتٌ", "جَدٌّ", "قِطٌّ", "فَمٌ", "يَدٌ"
            ],
            
            // مد بالألف
            alif: [
                "قَالَ", "بَابٌ", "نَامَ", "كِتَابٌ", "صِيَامٌ", "حِصَانٌ", "غَزَالٌ", "جِبَالٌ", "جَمَالٌ", "طَعَامٌ",
                "شِبَاكٌ", "رِمَالٌ", "قِطَارٌ", "مَطَارٌ", "حِمَارٌ", "خِيَارٌ", "دَجَاجٌ", "ذُبَابٌ", "زَرَافَةٌ", "سَحَابٌ",
                "صَفَاءٌ", "طَائِرٌ", "عَامٌ", "غَائِبٌ", "فَانُوسٌ", "قَامَ", "كِتَابَةٌ", "لِبَاسٌ", "مَاءٌ", "نَارٌ"
            ],
            
            // مد بالواو 
            waw: [
                "نُورٌ", "حُوتٌ", "سُورٌ", "بُوقٌ", "قُولُ", "تُوتٌ", "جُوعٌ", "خُوخٌ", "دُودٌ", "رُوحٌ",
                "سُوقٌ", "عُودٌ", "فُولٌ", "كُوبٌ", "لُومُ", "مُوجٌ", "نُونٌ", "هُودٌ", "طُيُورٌ", "زُهُورٌ",
                "نُجُومٌ", "بُذُورٌ", "عُصْفُورٌ", "طَاوُوسٌ", "صُنْدُوقٌ", "صُورَةٌ", "قُرُودٌ", "فُؤَادٌ", "عُيُونٌ", "خُيُولٌ"
            ],
            
            // مد بالياء 
            yaa: [
                "قَرِيبٌ", "طَبِيبٌ", "جَمِيلٌ", "قَلِيلٌ", "كَبِيرٌ", "صَغِيرٌ", "قَدِيمٌ", "جَدِيدٌ", "لَطِيفٌ", "نَظِيفٌ",
                "سَرِيعٌ", "بَطِيءٌ", "سَعِيدٌ", "حَزِينٌ", "طَوِيلٌ", "قَصِيرٌ", "حَلِيبٌ", "عَصِيرٌ", "رَغِيفٌ", "سَرِيرٌ",
                "تِينٌ", "فِيلٌ", "دِيكٌ", "رِيشٌ", "طِينٌ", "عِيدٌ", "أَمِيرٌ", "وَزِيرٌ", "خَمِيسٌ", "طَرِيقٌ"
            ],
            
            // الـ القمرية
            alQamariya: [
                "القَمَرُ", "البَحْرُ", "الجَمَلُ", "الحِصَانُ", "الخُبْزُ", "العَيْنُ", "الغُرَابُ", "الفَمُ", "القَلَمُ", "الكِتَابُ",
                "المَطَرُ", "الهِلَالُ", "الوَلَدُ", "اليَدُ", "الأَرْضُ", "البَابُ", "الجَبَلُ", "الحَدِيقَةُ", "الخَرُوفُ", "العِلْمُ",
                "الغُصْنُ", "الفِيلُ", "القِطُّ", "الكَأْسُ", "المَدْرَسَةُ", "الهُدْهُدُ", "الوَرْدَةُ", "اليَمَامَةُ", "الأَدَبُ", "البِنْتُ"
            ],
            
            // الـ الشمسية 
            alShamsiya: [
                "الشَّمْسُ", "السَّمَاءُ", "التُّفَّاحُ", "الثَّوْبُ", "الدَّرْسُ", "الذَّهَبُ", "الرَّجُلُ", "الزَّهْرَةُ", "السَّيَّارَةُ", "الشَّجَرَةُ",
                "الصَّدِيقُ", "الضَّوْءُ", "الطَّيْرُ", "الظَّرْفُ", "اللَّبَنُ", "النَّحْلَةُ", "التَّاجِرُ", "الثَّعْلَبُ", "الدِّيكُ", "الذُّبَابُ",
                "الرَّمْلُ", "الزَّرَافَةُ", "السُّورُ", "الشَّارِعُ", "الصَّقْرُ", "الضِّفْدَعُ", "الطَّبِيبُ", "الظُّهْرُ", "اللَّيْلُ", "النُّجُومُ"
            ],
            
            // كلمات بالشدة 
            shadda: [
                "أُمِّي", "جَدِّي", "مُعَلِّمٌ", "سَبُّورَةٌ", "قِطَّةٌ", "بَطَّةٌ", "سِكِّينٌ", "رُمَّانٌ", "صَفٌّ", "حَقٌّ",
                "مَقَصٌّ", "سُلَّمٌ", "طَيَّارٌ", "خَبَّازٌ", "رَسَّامٌ", "نَجَّارٌ", "دَرَّاجَةٌ", "يُحِبُّ", "يُعَلِّمُ", "يُسَبِّحُ",
                "قُوَّةٌ", "صِحَّةٌ", "قِصَّةٌ", "جَنَّةٌ", "كُرَّاسَةٌ", "فَلَّاحٌ", "طَبَّاخٌ", "بَرَّادٌ", "مُرَبًّى", "سِنٌّ"
            ],
            
            // تنوين فتح 
            tanwinFath: [
                "كِتَابًا", "قَلَمًا", "بَابًا", "وَلَدًا", "بَيْتًا", "شَجَرًا", "نَهْرًا", "بَحْرًا", "جَبَلًا", "صَدِيقًا",
                "طَرِيقًا", "عِلْمًا", "وَرَقًا", "قَمَرًا", "شَمْسًا", "نُورًا", "مَطَرًا", "زَهْرًا", "ثَوْبًا", "طَالِبًا",
                "مُعَلِّمًا", "أَسَدًا", "جَمَلًا", "فِيلًا", "كَلْبًا", "خَرُوفًا", "عُصْفُورًا", "سَرِيعًا", "جَمِيلًا", "كَبِيرًا"
            ],
            
            // تنوين ضم 
            tanwinDamm: [
                "مُعَلِّمٌ", "طَالِبٌ", "كِتَابٌ", "قَلَمٌ", "بَابٌ", "وَلَدٌ", "بَيْتٌ", "شَجَرٌ", "نَهْرٌ", "سَمَاءٌ",
                "بَحْرٌ", "جَبَلٌ", "صَدِيقٌ", "طَرِيقٌ", "وَرَقٌ", "قَمَرٌ", "شَمْسٌ", "نُورٌ", "مَطَرٌ", "أَسَدٌ",
                "جَمَلٌ", "فِيلٌ", "كَلْبٌ", "خَرُوفٌ", "عُصْفُورٌ", "زَهْرَةٌ", "سَرِيعٌ", "جَمِيلٌ", "كَبِيرٌ", "صَغِيرٌ"
            ],
            
            // تنوين كسر 
            tanwinKasr: [
                "مُعَلِّمٍ", "طَالِبٍ", "كِتَابٍ", "قَلَمٍ", "بَابٍ", "وَلَدٍ", "بَيْتٍ", "شَجَرٍ", "نَهْرٍ", "سَمَاءٍ",
                "بَحْرٍ", "جَبَلٍ", "صَدِيقٍ", "طَرِيقٍ", "وَرَقٍ", "قَمَرٍ", "شَمْسٍ", "نُورٍ", "مَطَرٍ", "أَسَدٍ",
                "جَمَلٍ", "فِيلٍ", "كَلْبٍ", "خَرُوفٍ", "عُصْفُورٍ", "زَهْرَةٍ", "سَرِيعٍ", "جَمِيلٍ", "kَبِيرٍ", "صَغِيرٍ"
            ],
            
            // تاء مربوطة 
            taaMarbuta: [
                "مَدْرَسَةٌ", "سَيَّارَةٌ", "حَقِيبَةٌ", "قِطَّةٌ", "كُرَةٌ", "سَاعَةٌ", "شَجَرَةٌ", "طَاوِلَةٌ", "سَفِينَةٌ", "غُرْفَةٌ",
                "حَدِيقَةٌ", "مَكْتَبَةٌ", "مِسْطَرَةٌ", "صُورَةٌ", "جَرِيدَةٌ", "مَجَلَّةٌ", "مَائِدَةٌ", "زُجَاجَةٌ", "عُلْبَةٌ", "وَرْدَةٌ",
                "نَحْلَةٌ", "فَرَاشَةٌ", "نَظَّارَةٌ", "قُبَّعَةٌ", "مِنْشَفَةٌ", "مِظَلَّةٌ", "لَوْحَةٌ", "قِصَّةٌ", "طَيَّارَةٌ", "غَابَةٌ"
            ],
            
            // تاء مفتوحة 
            taaMaftuha: [
                "ذَهَبْتُ", "كَتَبْتُ", "قَرَأْتُ", "لَعِبْتُ", "بَيْتٌ", "بِنْتٌ", "تُوتٌ", "حُوتٌ", "زَيْتٌ", "وَقْتٌ",
                "أَنْتَ", "أَنْتِ", "سَكَتَ", "مَاتَ", "صَوْتٌ", "نَبَاتٌ", "أُخْتٌ", "عَنْكَبُوتٌ", "طَيَّارَاتٌ", "سَيَّارَاتٌ",
                "مُعَلِّمَاتٌ", "فَتَيَاتٌ", "مَدْرَسَاتٌ", "أَكَلْتُ", "شَرِبْتُ", "نِمْتُ", "خَرَجْتُ", "فَهِمْتُ", "رَسَمْتُ", "سَمِعْتُ"
            ],
            
            // هاء آخر الكلمة
            haaEnd: [
                "كِتَابُهُ", "بَيْتُهُ", "قَلَمُهُ", "مَعَهُ", "لَهُ", "عَنْهُ", "مِنْهُ", "وَجْهٌ", "مِيَاهٌ", "مُنْتَبِهٌ",
                "إِلَيْهِ", "عَلَيْهِ", "فِيهِ", "يُشْبِهُ", "يَتَفَوَّهُ", "اللهُ", "هذِهِ", "فَوَاكِهُ", "نَفْسُهُ", "ثَوْبُهُ",
                "رَأْسُهُ", "يَدُهُ", "رِجْلُهُ", "صَدِيقُهُ", "مَدْرَسَتُهُ", "أُمُّهُ", "أَبُوهُ", "أَخُوهُ", "عُمُرُهُ", "اِسْمُهُ"
            ]
        };
        
        // قاعدة نصوص للكتابة (للصفوف الأعلى) - 5 نصوص فقط
        const writingTexts = [
            "ذهبَ أحمدُ إلى المدرسةِ مبكراً لأنه يحبُ التعلمَ والدراسةَ، وكانَ دائماً من الأوائلِ في صفِّه.",
            "يحبُ الطلابُ القراءةَ والكتابةَ لأنها توسعُ مداركهم وتزيدُ من ثقافتهم، وتساعدهم في فهمِ العالمِ من حولهم.",
            "الطقسُ اليومَ جميلٌ ومشمسٌ، فالسماءُ صافيةٌ والشمسُ ساطعةٌ، مما يجعلُ النهارَ مناسباً للتنزهِ واللعبِ في الحديقةِ.",
            "العصفورُ يغردُ على الشجرةِ بصوتٍ جميلٍ، والزهورُ تتمايلُ مع نسماتِ الهواءِ العليلِ، مما يُضفي جواً من السعادةِ والراحةِ.",
            "يجبُ على الطلابِ أن يحرصوا على النظافةِ الشخصيةِ ونظافةِ المدرسةِ، لأن النظافةَ من الإيمانِ وتحمي من الأمراضِ."
        ];
        
        // عناوين المهارات
        const skillTitles = {
            threeFatha: "كلمات سهلة (بالفتح)",
            threeVarious: "كلمات متنوعة الحركات",
            alif: "مد الألف",
            waw: "مد الواو",
            yaa: "مد الياء",
            alQamariya: "الـ القمرية",
            alShamsiya: "الـ الشمسية",
            shadda: "كلمات بالشدة",
            tanwinFath: "تنوين بالفتح",
            tanwinDamm: "تنوين بالضم",
            tanwinKasr: "تنوين بالكسر",
            taaMarbuta: "التاء المربوطة (ـة)",
            taaMaftuha: "التاء المفتوحة (ت)",
            haaEnd: "الهاء (ـه)"
        };
        
        // عرض رسالة نجاح
        function showSuccessMessage(message) {
            const successMsg = document.getElementById('success-message');
            if (message) {
                successMsg.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            }
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 2000);
        }
        
        // عرض رسالة خطأ
        function showErrorMessage(message) {
            const successMsg = document.getElementById('success-message');
            successMsg.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            successMsg.style.background = '#e74c3c';
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
                successMsg.style.background = '#2ecc71';
            }, 2000);
        }
        
        // البيانات والتطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // حالة التطبيق
            const appState = {
                words: new Array(20).fill(''),
                texts: [...writingTexts], // نصوص للكتابة (5 نصوص فقط)
                displayTime: 5,
                writingTime: 30,
                fontSize: 'medium',
                fontType: 'cairo',
                textColor: '#2c3e50',
                usedCards: [],
                usedWords: new Set(), // لتجنب تكرار الكلمات
                currentCard: null,
                displayTimer: null,
                writingTimer: null,
                writingTimeLeft: 30,
                isWritingTime: false,
                filledCount: 0,
                lastClickedTag: null,
                selectedSkills: Object.keys(skillTitles).reduce((acc, key) => {
                    acc[key] = true;
                    return acc;
                }, {}),
                writtenWords: [], // لتخزين الكلمات التي تم عرضها
                currentMode: 'words', // 'words' أو 'text'
                isTextModeActive: false, // هل وضع إملاء النص نشط؟
                currentSkillModal: null, // المهارة الحالية المفتوحة في النافذة
                selectedModalWords: new Set() // الكلمات المحددة في نافذة المهارة
            };
            
            // عناصر الواجهة
            const settingsModal = document.getElementById('settings-modal');
            const openSettingsBtn = document.getElementById('open-settings');
            const closeSettingsBtn = document.getElementById('close-settings');
            const startBtn = document.getElementById('start-btn');
            const wordsReviewModal = document.getElementById('words-review-modal');
            const closeReviewBtn = document.getElementById('close-review');
            const closeReviewBtn2 = document.getElementById('close-review-btn');
            const showWordsBtn = document.getElementById('show-words-btn');
            const finishBtn = document.getElementById('finish-btn');
            const textModeBtn = document.getElementById('text-mode-btn');
            const restartBtn = document.getElementById('restart-btn');
            const displayLayout = document.getElementById('display-layout');
            const wordDisplay = document.getElementById('word-display');
            const cardsGrid = document.getElementById('cards-grid');
            const cardsTitle = document.getElementById('cards-title');
            
            // نافذة الكلمات للمهارة
            const wordsModal = document.getElementById('words-modal');
            const closeWordsModalBtn = document.getElementById('close-words-modal');
            const modalSkillTitle = document.getElementById('modal-skill-title');
            const modalWordsGrid = document.getElementById('modal-words-grid');
            const selectAllWordsBtn = document.getElementById('select-all-words-btn');
            const addSelectedWordsBtn = document.getElementById('add-selected-words-btn');
            
            // نافذة التعليمات الجديدة
            const instructionsModal = document.getElementById('instructions-modal');
            const closeInstructionsBtn = document.getElementById('close-instructions');
            const understandInstructionsBtn = document.getElementById('understand-instructions');
            const openSettingsFromInstructionsBtn = document.getElementById('open-settings-from-instructions');
            
            // فتح إغلاق نافذة الإعدادات
            openSettingsBtn.addEventListener('click', () => settingsModal.classList.add('active'));
            closeSettingsBtn.addEventListener('click', () => settingsModal.classList.remove('active'));
            
            // فتح إغلاق نافذة التعليمات
            closeInstructionsBtn.addEventListener('click', () => instructionsModal.classList.remove('active'));
            understandInstructionsBtn.addEventListener('click', () => instructionsModal.classList.remove('active'));
            openSettingsFromInstructionsBtn.addEventListener('click', () => {
                instructionsModal.classList.remove('active');
                settingsModal.classList.add('active');
            });
            
            instructionsModal.addEventListener('click', (e) => {
                if (e.target === instructionsModal) {
                    instructionsModal.classList.remove('active');
                }
            });
            
            // فتح إغلاق نافذة عرض الكلمات المكتوبة
            showWordsBtn.addEventListener('click', () => {
                updateWordsReviewModal();
                wordsReviewModal.classList.add('active');
            });
            
            closeReviewBtn.addEventListener('click', () => wordsReviewModal.classList.remove('active'));
            closeReviewBtn2.addEventListener('click', () => wordsReviewModal.classList.remove('active'));
            
            // فتح إغلاق نافذة الكلمات للمهارة
            closeWordsModalBtn.addEventListener('click', () => {
                wordsModal.classList.remove('active');
                appState.currentSkillModal = null;
                appState.selectedModalWords.clear();
            });
            
            wordsModal.addEventListener('click', (e) => {
                if (e.target === wordsModal) {
                    wordsModal.classList.remove('active');
                    appState.currentSkillModal = null;
                    appState.selectedModalWords.clear();
                }
            });
            
            // زر تحديد كل الكلمات في نافذة المهارة
            selectAllWordsBtn.addEventListener('click', function() {
                const wordTags = modalWordsGrid.querySelectorAll('.modal-word-tag');
                const allSelected = Array.from(wordTags).every(tag => tag.classList.contains('selected'));
                
                wordTags.forEach(tag => {
                    const word = tag.dataset.word;
                    if (allSelected) {
                        tag.classList.remove('selected');
                        appState.selectedModalWords.delete(word);
                    } else {
                        tag.classList.add('selected');
                        appState.selectedModalWords.add(word);
                    }
                });
                
                const actionText = allSelected ? 'تم إلغاء تحديد جميع الكلمات' : 'تم تحديد جميع الكلمات';
                showSuccessMessage(actionText);
            });
            
            // زر إضافة الكلمات المحددة
            addSelectedWordsBtn.addEventListener('click', function() {
                if (appState.selectedModalWords.size === 0) {
                    showErrorMessage('الرجاء تحديد كلمة واحدة على الأقل');
                    return;
                }
                
                const wordsArray = Array.from(appState.selectedModalWords);
                let addedCount = 0;
                
                for (let i = 0; i < 20 && addedCount < wordsArray.length; i++) {
                    if (!appState.words[i] || appState.words[i].trim() === '') {
                        appState.words[i] = wordsArray[addedCount];
                        const input = document.getElementById(`word-input-${i}`);
                        if (input) {
                            input.value = wordsArray[addedCount];
                        }
                        addedCount++;
                    }
                }
                
                showSuccessMessage(`تمت إضافة ${addedCount} كلمة إلى الحقول`);
                wordsModal.classList.remove('active');
                appState.selectedModalWords.clear();
                
                // تحديث عدد الحقول المملوءة
                appState.filledCount = 0;
                for (let i = 0; i < 20; i++) {
                    if (appState.words[i] && appState.words[i].trim() !== '') {
                        appState.filledCount++;
                    }
                }
            });
            
            // زر إنهاء الإملاء
            finishBtn.addEventListener('click', function() {
                if (appState.displayTimer) clearInterval(appState.displayTimer);
                if (appState.writingTimer) {
                    clearInterval(appState.writingTimer);
                    appState.isWritingTime = false;
                }
                
                document.getElementById('full-progress-container').classList.remove('active');
                
                wordDisplay.textContent = 'تم إنهاء جلسة الإملاء';
                updateWordDisplaySize();
                updateWordDisplayFont();
                updateWordDisplayColor();
                document.getElementById('timer-display').textContent = '--';
                
                updateWordsReviewModal();
                wordsReviewModal.classList.add('active');
                
                showSuccessMessage('تم إنهاء جلسة الإملاء بنجاح');
            });
            
            // زر التبديل إلى وضع إملاء النص
            textModeBtn.addEventListener('click', function() {
                appState.isTextModeActive = !appState.isTextModeActive;
                
                if (appState.isTextModeActive) {
                    this.innerHTML = '<i class="fas fa-font"></i> التبديل إلى إملاء الكلمات';
                    this.classList.remove('text-mode-btn');
                    this.classList.add('words-mode-btn');
                    
                    // تفعيل وضع إملاء النص
                    displayLayout.classList.add('text-mode');
                    wordDisplay.classList.add('text-mode');
                    cardsGrid.classList.add('text-mode');
                    cardsTitle.textContent = 'اختر نصاً';
                    
                    // تحديث شريط الحالة
                    document.querySelector('.status-item .status-label').textContent = 'النصوص المتبقية';
                    
                    showSuccessMessage('تم تفعيل وضع إملاء النص للصفوف الأعلى');
                } else {
                    this.innerHTML = '<i class="fas fa-font"></i> التبديل إلى إملاء نص';
                    this.classList.remove('words-mode-btn');
                    this.classList.add('text-mode-btn');
                    
                    // تفعيل وضع الكلمات
                    displayLayout.classList.remove('text-mode');
                    wordDisplay.classList.remove('text-mode');
                    cardsGrid.classList.remove('text-mode');
                    cardsTitle.textContent = 'اختر رقم';
                    
                    // تحديث شريط الحالة
                    document.querySelector('.status-item .status-label').textContent = 'الكلمات المتبقية';
                    
                    showSuccessMessage('تم تفعيل وضع إملاء الكلمات للصفوف الأولية');
                }
                
                // تحديث البطاقات حسب الوضع
                createCards();
            });
            
            // إغلاق النوافذ بالنقر خارجها
            settingsModal.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    settingsModal.classList.remove('active');
                }
            });
            
            wordsReviewModal.addEventListener('click', (e) => {
                if (e.target === wordsReviewModal) {
                    wordsReviewModal.classList.remove('active');
                }
            });
            
            // تهيئة قسم الإعدادات
            function initSettingsSection() {
                // إنشاء مربعات إدخال الكلمات
                createWordInputs();
                
                // إنشاء مربعات إدخال النصوص
                createTextInputs();
                
                // إعداد علامات التبويب للوضعين
                setupModeTabs();
                
                // إعداد مربعات المهارات
                setupSkillBoxes();
                
                // إعداد مربعات اختيار المهارات للتعبئة العشوائية
                setupSkillsSelection();
                
                // إعدادات الوقت - زيادة الحدود
                const displayTimeSlider = document.getElementById('display-time-slider');
                const displayTimeDisplay = document.getElementById('display-time-display');
                
                displayTimeSlider.value = appState.displayTime;
                displayTimeDisplay.textContent = `${appState.displayTime} ثواني`;
                
                displayTimeSlider.addEventListener('input', function() {
                    appState.displayTime = parseInt(this.value);
                    displayTimeDisplay.textContent = `${appState.displayTime} ثواني`;
                });
                
                // إعداد وقت الكتابة - زيادة إلى 300 ثانية (5 دقائق)
                const writingTimeSlider = document.getElementById('writing-time-slider');
                const writingTimeDisplay = document.getElementById('writing-time-display');
                
                writingTimeSlider.value = appState.writingTime;
                writingTimeDisplay.textContent = `${appState.writingTime} ثانية`;
                
                writingTimeSlider.addEventListener('input', function() {
                    appState.writingTime = parseInt(this.value);
                    writingTimeDisplay.textContent = `${appState.writingTime} ثانية`;
                    document.getElementById('writing-time-status').textContent = `${appState.writingTime} ثانية`;
                });
                
                // إعدادات حجم الخط
                const fontSizeOptions = document.querySelectorAll('.setting-option[data-font-size]');
                fontSizeOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        fontSizeOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        appState.fontSize = this.dataset.fontSize;
                        updateWordDisplaySize();
                        updateFontPreview();
                    });
                });
                
                // إعدادات نوع الخط
                const fontTypeOptions = document.querySelectorAll('.font-type-option[data-font-type]');
                fontTypeOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        fontTypeOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        appState.fontType = this.dataset.fontType;
                        updateWordDisplayFont();
                        updateFontPreview();
                    });
                });
                
                // إعدادات لون النص
                const colorPicker = document.getElementById('color-picker');
                colorPicker.value = appState.textColor;
                colorPicker.addEventListener('input', function() {
                    appState.textColor = this.value;
                    updateWordDisplayColor();
                    updateFontPreview();
                });
                
                // مربع الإدخال السريع للكلمات
                const quickInputTextarea = document.getElementById('quick-input-textarea');
                const loadWordsBtn = document.getElementById('load-words-btn');
                const clearTextareaBtn = document.getElementById('clear-textarea-btn');
                
                loadWordsBtn.addEventListener('click', function() {
                    const text = quickInputTextarea.value.trim();
                    if (!text) {
                        showErrorMessage('الرجاء إدخال قائمة كلمات');
                        return;
                    }
                    
                    // تقسيم النص إلى كلمات (يفصل بينها فواصل أو مسافات أو أسطر جديدة)
                    const words = text.split(/[\n,،\s]+/).filter(word => word.trim() !== '');
                    
                    if (words.length === 0) {
                        showErrorMessage('لم يتم العثور على كلمات');
                        return;
                    }
                    
                    appState.filledCount = 0;
                    for (let i = 0; i < 20 && i < words.length; i++) {
                        appState.words[i] = words[i];
                        const input = document.getElementById(`word-input-${i}`);
                        if (input) {
                            input.value = words[i];
                            appState.filledCount++;
                        }
                    }
                    
                    // ملء الباقي فارغاً إذا كانت الكلمات أقل من 20
                    for (let i = words.length; i < 20; i++) {
                        appState.words[i] = '';
                        const input = document.getElementById(`word-input-${i}`);
                        if (input) {
                            input.value = '';
                        }
                    }
                    
                    showSuccessMessage(`تم تحميل ${Math.min(20, words.length)} كلمة`);
                });
                
                clearTextareaBtn.addEventListener('click', function() {
                    quickInputTextarea.value = '';
                    quickInputTextarea.focus();
                });
                
                // مربع الإدخال السريع للنصوص
                const quickTextInputTextarea = document.getElementById('quick-text-input-textarea');
                const loadTextsBtn = document.getElementById('load-texts-btn');
                const clearTextTextareaBtn = document.getElementById('clear-text-textarea-btn');
                
                // تعبئة النصوص الافتراضية في مربع النصوص
                quickTextInputTextarea.value = writingTexts.join('\n\n');
                
                loadTextsBtn.addEventListener('click', function() {
                    const text = quickTextInputTextarea.value.trim();
                    if (!text) {
                        showErrorMessage('الرجاء إدخال قائمة نصوص');
                        return;
                    }
                    
                    // تقسيم النص إلى نصوص (يفصل بينها أسطر جديدة مزدوجة)
                    const texts = text.split(/\n\s*\n/).filter(t => t.trim() !== '');
                    
                    if (texts.length === 0) {
                        showErrorMessage('لم يتم العثور على نصوص');
                        return;
                    }
                    
                    // تعبئة 5 نصوص فقط
                    for (let i = 0; i < 5 && i < texts.length; i++) {
                        appState.texts[i] = texts[i];
                        const input = document.getElementById(`text-input-${i}`);
                        if (input) {
                            input.value = texts[i];
                        }
                    }
                    
                    // ملء الباقي فارغاً إذا كانت النصوص أقل من 5
                    for (let i = texts.length; i < 5; i++) {
                        appState.texts[i] = '';
                        const input = document.getElementById(`text-input-${i}`);
                        if (input) {
                            input.value = '';
                        }
                    }
                    
                    showSuccessMessage(`تم تحميل ${Math.min(5, texts.length)} نص`);
                });
                
                clearTextTextareaBtn.addEventListener('click', function() {
                    quickTextInputTextarea.value = '';
                    quickTextInputTextarea.focus();
                });
                
                // زر التعبئة العشوائية
                document.getElementById('fill-random-btn').addEventListener('click', function() {
                    let allWords = [];
                    
                    // جمع الكلمات من المهارات المحددة فقط
                    Object.keys(appState.selectedSkills).forEach(skillKey => {
                        if (appState.selectedSkills[skillKey] && wordBank[skillKey]) {
                            const shuffled = [...wordBank[skillKey]].sort(() => Math.random() - 0.5).slice(0, 10);
                            allWords.push(...shuffled);
                        }
                    });
                    
                    if (allWords.length === 0) {
                        showErrorMessage('الرجاء اختيار مهارة واحدة على الأقل');
                        return;
                    }
                    
                    const shuffledWords = allWords.sort(() => Math.random() - 0.5);
                    
                    appState.filledCount = 0;
                    for (let i = 0; i < 20 && i < shuffledWords.length; i++) {
                        appState.words[i] = shuffledWords[i];
                        const input = document.getElementById(`word-input-${i}`);
                        if (input) {
                            input.value = shuffledWords[i];
                            appState.filledCount++;
                        }
                    }
                    
                    for (let i = shuffledWords.length; i < 20; i++) {
                        appState.words[i] = '';
                        const input = document.getElementById(`word-input-${i}`);
                        if (input) {
                            input.value = '';
                        }
                    }
                    
                    showSuccessMessage(`تم تعبئة الحقول بـ ${Math.min(20, shuffledWords.length)} كلمة عشوائية`);
                });
                
                // زر إعادة تعيين
                document.getElementById('reset-btn').addEventListener('click', function() {
                    appState.words.fill('');
                    appState.texts = [...writingTexts];
                    appState.filledCount = 0;
                    initSettingsSection();
                    
                    appState.displayTime = 5;
                    displayTimeSlider.value = 5;
                    displayTimeDisplay.textContent = '5 ثواني';
                    
                    writingTimeSlider.value = 30;
                    appState.writingTime = 30;
                    writingTimeDisplay.textContent = '30 ثانية';
                    document.getElementById('writing-time-status').textContent = '30 ثانية';
                    
                    fontSizeOptions.forEach(opt => opt.classList.remove('selected'));
                    fontSizeOptions[0].classList.add('selected');
                    appState.fontSize = 'medium';
                    
                    fontTypeOptions.forEach(opt => opt.classList.remove('selected'));
                    fontTypeOptions[0].classList.add('selected');
                    appState.fontType = 'cairo';
                    
                    colorPicker.value = '#2c3e50';
                    appState.textColor = '#2c3e50';
                    
                    Object.keys(appState.selectedSkills).forEach(key => {
                        appState.selectedSkills[key] = true;
                    });
                    setupSkillsSelection();
                    
                    updateWordDisplaySize();
                    updateWordDisplayFont();
                    updateWordDisplayColor();
                    updateFontPreview();
                    
                    showSuccessMessage('تم إعادة تعيين جميع الحقول والإعدادات');
                });
                
                // زر إفراغ الحقول
                document.getElementById('clear-all-btn').addEventListener('click', function() {
                    appState.words.fill('');
                    appState.filledCount = 0;
                    createWordInputs();
                    showSuccessMessage('تم إفراغ جميع الحقول');
                });
                
                // زر بدء الإملاء
                startBtn.addEventListener('click', function() {
                    if (appState.currentMode === 'words') {
                        appState.filledCount = 0;
                        for (let i = 0; i < 20; i++) {
                            if (appState.words[i] && appState.words[i].trim() !== '') {
                                appState.filledCount++;
                            }
                        }
                        
                        if (appState.filledCount < 5) {
                            showErrorMessage('الرجاء إدخال 5 كلمات على الأقل');
                            return;
                        }
                    } else {
                        // في وضع إملاء النص، نتحقق من وجود نصوص
                        let textsCount = 0;
                        for (let i = 0; i < 5; i++) {
                            if (appState.texts[i] && appState.texts[i].trim() !== '') {
                                textsCount++;
                            }
                        }
                        
                        if (textsCount < 1) {
                            showErrorMessage('الرجاء إدخال نص واحد على الأقل');
                            return;
                        }
                    }
                    
                    settingsModal.classList.remove('active');
                    initDisplaySection();
                    showSuccessMessage('تم بدء الإملاء');
                });
                
                // تحديث مربع العرض التجريبي
                updateFontPreview();
            }
            
            // إنشاء مربعات إدخال الكلمات
            function createWordInputs() {
                const container = document.getElementById('words-input-container');
                container.innerHTML = '';
                
                for (let i = 0; i < 20; i++) {
                    const inputBox = document.createElement('div');
                    inputBox.className = 'word-input-box';
                    
                    const label = document.createElement('div');
                    label.className = 'word-label';
                    label.textContent = `${i + 1}`;
                    
                    const input = document.createElement('input');
                    input.className = 'word-input';
                    input.type = 'text';
                    input.placeholder = 'كلمة';
                    input.value = appState.words[i];
                    input.id = `word-input-${i}`;
                    
                    input.addEventListener('input', function() {
                        const oldValue = appState.words[i];
                        const newValue = this.value.trim();
                        appState.words[i] = newValue;
                        
                        if (oldValue === '' && newValue !== '') {
                            appState.filledCount++;
                        } else if (oldValue !== '' && newValue === '') {
                            appState.filledCount--;
                        }
                    });
                    
                    inputBox.appendChild(label);
                    inputBox.appendChild(input);
                    container.appendChild(inputBox);
                }
            }
            
            // إنشاء مربعات إدخال النصوص (5 فقط)
            function createTextInputs() {
                const container = document.getElementById('texts-input-container');
                container.innerHTML = '';
                
                for (let i = 0; i < 5; i++) {
                    const inputBox = document.createElement('div');
                    inputBox.className = 'text-input-box';
                    
                    const label = document.createElement('div');
                    label.className = 'text-label';
                    label.textContent = `نص ${i + 1}`;
                    
                    const input = document.createElement('textarea');
                    input.className = 'text-input text-auto-fit';
                    input.placeholder = 'اكتب نصاً للكتابة...';
                    input.value = appState.texts[i] || '';
                    input.id = `text-input-${i}`;
                    
                    input.addEventListener('input', function() {
                        appState.texts[i] = this.value.trim();
                    });
                    
                    inputBox.appendChild(label);
                    inputBox.appendChild(input);
                    container.appendChild(inputBox);
                }
            }
            
            // إعداد علامات التبويب للوضعين
            function setupModeTabs() {
                const modeTabs = document.querySelectorAll('.mode-tab');
                const wordsInputGroup = document.getElementById('words-input-group');
                const textsInputGroup = document.getElementById('texts-input-group');
                const wordsModeSettings = document.getElementById('words-mode-settings');
                const textModeSettings = document.getElementById('text-mode-settings');
                
                modeTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const mode = this.dataset.mode;
                        
                        // تحديث علامات التبويب النشطة
                        modeTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // تحديث حالة التطبيق
                        appState.currentMode = mode;
                        
                        // إظهار/إخفاء الإعدادات المناسبة
                        if (mode === 'words') {
                            wordsModeSettings.classList.remove('hidden');
                            textModeSettings.classList.add('hidden');
                            wordsInputGroup.classList.remove('hidden');
                            textsInputGroup.classList.add('hidden');
                        } else {
                            wordsModeSettings.classList.add('hidden');
                            textModeSettings.classList.remove('hidden');
                            wordsInputGroup.classList.add('hidden');
                            textsInputGroup.classList.remove('hidden');
                        }
                        
                        showSuccessMessage(`تم التبديل إلى ${mode === 'words' ? 'إملاء الكلمات' : 'إملاء النص'}`);
                    });
                });
            }
            
            // إعداد مربعات المهارات
            function setupSkillBoxes() {
                const skillsContainer = document.getElementById('skills-container');
                skillsContainer.innerHTML = '';
                
                Object.keys(skillTitles).forEach(skillKey => {
                    const skillBox = document.createElement('div');
                    skillBox.className = 'skill-box';
                    skillBox.dataset.skillKey = skillKey;
                    skillBox.textContent = skillTitles[skillKey];
                    
                    skillBox.addEventListener('click', function() {
                        const skillKey = this.dataset.skillKey;
                        openSkillWordsModal(skillKey);
                    });
                    
                    skillsContainer.appendChild(skillBox);
                });
            }
            
            // فتح نافذة الكلمات للمهارة
            function openSkillWordsModal(skillKey) {
                appState.currentSkillModal = skillKey;
                appState.selectedModalWords.clear();
                
                modalSkillTitle.textContent = skillTitles[skillKey];
                modalWordsGrid.innerHTML = '';
                
                const words = wordBank[skillKey] || [];
                
                words.forEach(word => {
                    const wordTag = document.createElement('button');
                    wordTag.className = 'modal-word-tag';
                    wordTag.dataset.word = word;
                    wordTag.textContent = word;
                    
                    wordTag.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const word = this.dataset.word;
                        
                        if (this.classList.contains('selected')) {
                            this.classList.remove('selected');
                            appState.selectedModalWords.delete(word);
                        } else {
                            this.classList.add('selected');
                            appState.selectedModalWords.add(word);
                        }
                    });
                    
                    modalWordsGrid.appendChild(wordTag);
                });
                
                wordsModal.classList.add('active');
            }
            
            // إعداد مربعات اختيار المهارات للتعبئة العشوائية
            function setupSkillsSelection() {
                const skillsGrid = document.getElementById('skills-grid');
                skillsGrid.innerHTML = '';
                
                Object.keys(skillTitles).forEach(skillKey => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'skill-checkbox';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `skill-${skillKey}`;
                    checkbox.checked = appState.selectedSkills[skillKey];
                    
                    checkbox.addEventListener('change', function() {
                        appState.selectedSkills[skillKey] = this.checked;
                    });
                    
                    const label = document.createElement('label');
                    label.htmlFor = `skill-${skillKey}`;
                    label.textContent = skillTitles[skillKey];
                    
                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);
                    skillsGrid.appendChild(checkboxDiv);
                });
                
                // زر اختيار الكل
                document.getElementById('select-all-btn').addEventListener('click', function() {
                    Object.keys(appState.selectedSkills).forEach(key => {
                        appState.selectedSkills[key] = true;
                    });
                    updateSkillsCheckboxes();
                    showSuccessMessage('تم اختيار جميع المهارات');
                });
                
                // زر حذف الكل
                document.getElementById('deselect-all-btn').addEventListener('click', function() {
                    Object.keys(appState.selectedSkills).forEach(key => {
                        appState.selectedSkills[key] = false;
                    });
                    updateSkillsCheckboxes();
                    showSuccessMessage('تم إلغاء اختيار جميع المهارات');
                });
                
                updateSkillsCheckboxes();
            }
            
            // تحديث مربعات الاختيار
            function updateSkillsCheckboxes() {
                Object.keys(appState.selectedSkills).forEach(skillKey => {
                    const checkbox = document.getElementById(`skill-${skillKey}`);
                    if (checkbox) {
                        checkbox.checked = appState.selectedSkills[skillKey];
                    }
                });
            }
            
            // تحديث حجم عرض الكلمة
            function updateWordDisplaySize() {
                wordDisplay.classList.remove('font-size-medium', 'font-size-large', 'font-size-very-large');
                wordDisplay.classList.add(`font-size-${appState.fontSize}`);
                
                // ضبط حجم الخط بناءً على الإعداد
                if (appState.fontSize === 'medium') {
                    wordDisplay.style.fontSize = appState.isTextModeActive ? '3.2rem' : '4.5rem';
                } else if (appState.fontSize === 'large') {
                    wordDisplay.style.fontSize = appState.isTextModeActive ? '3.7rem' : '5.5rem';
                } else if (appState.fontSize === 'very-large') {
                    wordDisplay.style.fontSize = appState.isTextModeActive ? '4.2rem' : '6.5rem';
                }
            }
            
            // تحديث نوع خط عرض الكلمة
            function updateWordDisplayFont() {
                wordDisplay.classList.remove('font-cairo', 'font-amiri', 'font-almarai', 'font-lateef', 
                    'font-scheherazade', 'font-noto', 'font-tajawal', 'font-messiri');
                wordDisplay.classList.add(`font-${appState.fontType}`);
            }
            
            // تحديث لون عرض الكلمة
            function updateWordDisplayColor() {
                wordDisplay.style.color = appState.textColor;
            }
            
            // تحديث مربع العرض التجريبي
            function updateFontPreview() {
                const fontPreviewBox = document.getElementById('font-preview-box');
                fontPreviewBox.classList.remove('font-cairo', 'font-amiri', 'font-almarai', 'font-lateef', 
                    'font-scheherazade', 'font-noto', 'font-tajawal', 'font-messiri');
                fontPreviewBox.classList.add(`font-${appState.fontType}`);
                fontPreviewBox.style.color = appState.textColor;
                
                // ضبط حجم الخط بناءً على الإعداد
                if (appState.fontSize === 'medium') {
                    fontPreviewBox.style.fontSize = '2.5rem';
                } else if (appState.fontSize === 'large') {
                    fontPreviewBox.style.fontSize = '3rem';
                } else if (appState.fontSize === 'very-large') {
                    fontPreviewBox.style.fontSize = '3.5rem';
                }
            }
            
            // تهيئة قسم العرض
            function initDisplaySection() {
                appState.usedCards = [];
                appState.usedWords.clear(); // مسح الكلمات المستخدمة
                appState.writtenWords = []; // مسح الكلمات المكتوبة
                appState.currentCard = null;
                appState.writingTimeLeft = appState.writingTime;
                appState.isWritingTime = false;
                
                const progressFill = document.getElementById('full-progress-fill');
                progressFill.style.width = '100%';
                progressFill.style.transition = 'none';
                
                updateStatus();
                
                wordDisplay.textContent = 'اختر رقم';
                updateWordDisplaySize();
                updateWordDisplayFont();
                updateWordDisplayColor();
                
                document.getElementById('full-progress-container').classList.remove('active');
                document.getElementById('timer-display').textContent = '--';
                
                createCards();
                
                document.getElementById('writing-time-status').textContent = `${appState.writingTime} ثانية`;
            }
            
            // إنشاء البطاقات مع التحقق من البطاقة رقم 1
            function createCards() {
                cardsGrid.innerHTML = '';
                
                // تحديث عنوان البطاقات حسب الوضع
                if (appState.isTextModeActive) {
                    cardsTitle.textContent = 'اختر نصاً';
                } else {
                    cardsTitle.textContent = 'اختر رقم';
                }
                
                // عدد البطاقات حسب الوضع
                const numCards = appState.isTextModeActive ? 5 : 20;
                
                for (let i = 0; i < numCards; i++) {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.dataset.index = i;
                    
                    // تحديد المحتوى حسب الوضع
                    let content = '';
                    let isFilled = false;
                    
                    if (appState.isTextModeActive) {
                        content = appState.texts[i] || '';
                        isFilled = content.trim() !== '';
                        card.dataset.content = content;
                    } else {
                        content = appState.words[i] || '';
                        isFilled = content.trim() !== '';
                        card.dataset.content = content;
                    }
                    
                    const cardFront = document.createElement('div');
                    cardFront.className = 'card-front';
                    cardFront.textContent = i + 1;
                    
                    const cardBack = document.createElement('div');
                    cardBack.className = 'card-back';
                    
                    // عرض المحتوى المناسب حسب الوضع
                    if (appState.isTextModeActive) {
                        // عرض جزء من النص في وضع إملاء النص
                        const displayText = content.length > 40 ? content.substring(0, 40) + '...' : content;
                        cardBack.textContent = displayText || 'فارغ';
                    } else {
                        cardBack.textContent = content || 'فارغ';
                    }
                    
                    cardBack.classList.add(`font-${appState.fontType}`);
                    
                    card.appendChild(cardFront);
                    card.appendChild(cardBack);
                    
                    if (isFilled) {
                        // البطاقة المملوءة
                        card.addEventListener('click', function() {
                            const index = parseInt(this.dataset.index);
                            const content = this.dataset.content;
                            
                            // التحقق من أن المحتوى لم يستخدم من قبل (في وضع الكلمات فقط)
                            if (!appState.isTextModeActive && appState.usedWords.has(content)) {
                                showErrorMessage('هذه الكلمة تم استخدامها مسبقاً');
                                return;
                            }
                            
                            if (!appState.usedCards.includes(index) && !appState.isWritingTime) {
                                flipCard(this, index);
                            }
                        });
                    } else {
                        // البطاقة الفارغة
                        card.classList.add('used');
                        card.style.opacity = '0.5';
                        card.style.cursor = 'not-allowed';
                        
                        // خاصية خاصة للبطاقة رقم 1 الفارغة
                        if (i === 0) {
                            card.style.cursor = 'pointer';
                            card.title = 'انقر لعرض تعليمات إضافة الكلمات';
                            
                            card.addEventListener('click', function() {
                                // عرض نافذة التعليمات فقط للبطاقة رقم 1 الفارغة
                                instructionsModal.classList.add('active');
                                showSuccessMessage('عرض دليل إضافة الكلمات');
                            });
                        }
                    }
                    
                    cardsGrid.appendChild(card);
                }
            }
            
            // قلب البطاقة
            function flipCard(cardElement, index) {
                if (appState.displayTimer) clearInterval(appState.displayTimer);
                if (appState.writingTimer) {
                    clearInterval(appState.writingTimer);
                    appState.isWritingTime = false;
                }
                
                document.getElementById('full-progress-container').classList.remove('active');
                
                const progressFill = document.getElementById('full-progress-fill');
                progressFill.style.width = '100%';
                progressFill.style.transition = 'none';
                
                if (appState.currentCard !== null) {
                    const currentCard = document.querySelector(`.card[data-index="${appState.currentCard}"]`);
                    if (currentCard) {
                        currentCard.classList.remove('flipped');
                    }
                }
                
                cardElement.classList.add('flipped');
                appState.currentCard = index;
                
                // تحديد المحتوى المعروض حسب الوضع
                let content = '';
                if (appState.isTextModeActive) {
                    content = appState.texts[index] || '--';
                } else {
                    content = appState.words[index] || '--';
                }
                
                wordDisplay.textContent = content;
                updateWordDisplaySize();
                updateWordDisplayFont();
                updateWordDisplayColor();
                
                // إضافة المحتوى إلى قائمة المحتويات المكتوبة
                if (content !== '--') {
                    appState.writtenWords.push(content);
                }
                
                startDisplayTimer();
                
                if (!appState.usedCards.includes(index)) {
                    appState.usedCards.push(index);
                }
                
                // إضافة المحتوى إلى المحتويات المستخدمة لمنع تكرارها (في وضع الكلمات فقط)
                if (content !== '--' && !appState.isTextModeActive) {
                    appState.usedWords.add(content);
                }
                
                updateStatus();
            }
            
            // بدء عداد العرض
            function startDisplayTimer() {
                let timeLeft = appState.displayTime;
                document.getElementById('timer-display').textContent = timeLeft;
                
                appState.displayTimer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timer-display').textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        clearInterval(appState.displayTimer);
                        
                        wordDisplay.textContent = '';
                        document.getElementById('timer-display').textContent = '--';
                        
                        if (appState.currentCard !== null) {
                            const cardElement = document.querySelector(`.card[data-index="${appState.currentCard}"]`);
                            if (cardElement) {
                                cardElement.classList.remove('flipped');
                                cardElement.classList.add('used');
                            }
                        }
                        
                        startWritingTimer();
                    }
                }, 1000);
            }
            
            // بدء عداد الكتابة
            function startWritingTimer() {
                appState.isWritingTime = true;
                appState.writingTimeLeft = appState.writingTime;
                
                const progressContainer = document.getElementById('full-progress-container');
                progressContainer.classList.add('active');
                
                const progressFill = document.getElementById('full-progress-fill');
                progressFill.style.transition = `width ${appState.writingTime}s linear`;
                
                setTimeout(() => {
                    progressFill.style.width = '0%';
                }, 100);
                
                document.getElementById('writing-timer').textContent = appState.writingTimeLeft;
                
                appState.writingTimer = setInterval(() => {
                    appState.writingTimeLeft--;
                    document.getElementById('writing-timer').textContent = appState.writingTimeLeft;
                    
                    const progressPercentage = (appState.writingTimeLeft / appState.writingTime) * 100;
                    if (progressPercentage < 30) {
                        progressFill.style.background = 'linear-gradient(90deg, #e74c3c, #f39c12)';
                    } else if (progressPercentage < 60) {
                        progressFill.style.background = 'linear-gradient(90deg, #f39c12, #f1c40f)';
                    } else {
                        progressFill.style.background = 'linear-gradient(90deg, #2ecc71, #f1c40f)';
                    }
                    
                    if (appState.writingTimeLeft <= 0) {
                        clearInterval(appState.writingTimer);
                        progressContainer.classList.remove('active');
                        appState.isWritingTime = false;
                        
                        appState.currentCard = null;
                        
                        wordDisplay.textContent = 'انتهى وقت الكتابة';
                        updateWordDisplaySize();
                        updateWordDisplayFont();
                        updateWordDisplayColor();
                        
                        if (appState.usedCards.length >= appState.filledCount) {
                            setTimeout(() => {
                                showSuccessMessage('تهانينا! تم عرض جميع المحتويات');
                            }, 500);
                        }
                    }
                }, 1000);
            }
            
            // تحديث الحالة
            function updateStatus() {
                const remaining = appState.filledCount - appState.usedCards.length;
                document.getElementById('remaining-words').textContent = Math.max(0, remaining);
                document.getElementById('shown-words').textContent = appState.usedCards.length;
            }
            
            // تحديث نافذة عرض الكلمات المكتوبة
            function updateWordsReviewModal() {
                const reviewWordsList = document.getElementById('review-words-list');
                const totalWordsCount = document.getElementById('total-words-count');
                
                reviewWordsList.innerHTML = '';
                totalWordsCount.textContent = appState.writtenWords.length;
                
                if (appState.writtenWords.length === 0) {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.style.gridColumn = '1 / -1';
                    emptyMsg.style.textAlign = 'center';
                    emptyMsg.style.padding = '30px';
                    emptyMsg.style.color = '#7f8c8d';
                    emptyMsg.style.fontSize = '1.4rem';
                    emptyMsg.innerHTML = '<i class="fas fa-info-circle"></i> لم يتم كتابة أي محتوى بعد';
                    reviewWordsList.appendChild(emptyMsg);
                    return;
                }
                
                appState.writtenWords.forEach((content, index) => {
                    const wordItem = document.createElement('div');
                    wordItem.className = 'review-word-item';
                    
                    // الاحتواء التلقائي للنص الطويل
                    wordItem.textContent = content;
                    
                    wordItem.classList.add(`font-${appState.fontType}`);
                    wordItem.classList.add('text-auto-fit');
                    wordItem.style.color = appState.textColor;
                    
                    // ضبط حجم الخط حسب طول النص
                    if (content.length > 100) {
                        wordItem.style.fontSize = '1.2rem';
                    } else if (content.length > 50) {
                        wordItem.style.fontSize = '1.4rem';
                    }
                    
                    reviewWordsList.appendChild(wordItem);
                });
            }
            
            // زر إعادة التشغيل
            restartBtn.addEventListener('click', initDisplaySection);
            
            // بدء التطبيق
            initSettingsSection();
            initDisplaySection();
        });
    </script>
</body>
</html>
